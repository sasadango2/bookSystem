{% extends "base.html" %}

{% block title %}ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« - å›³æ›¸é¤¨ã‚·ã‚¹ãƒ†ãƒ {% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">ä¼šå“¡ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</h1>
        <p class="text-gray-600">ä¼šå“¡æƒ…å ±ã®ç¢ºèªãƒ»ç·¨é›†ãŒã§ãã¾ã™ã€‚</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- ä¼šå“¡æƒ…å ±ã‚«ãƒ¼ãƒ‰ -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">ğŸ‘¤</span>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900">
                        {{ user.get_full_name|default:user.username }}
                    </h2>
                    <p class="text-gray-600">{{ profile.get_membership_type_display }}</p>
                    <p class="text-sm text-gray-500">ä¼šå“¡ID: {{ profile.member_id }}</p>
                </div>

                <!-- ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹</span>
                        <span class="{% if profile.is_active %}text-green-600{% else %}text-red-600{% endif %} font-medium">
                            {% if profile.is_active %}æœ‰åŠ¹{% else %}ç„¡åŠ¹{% endif %}
                        </span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">å…¥ä¼šæ—¥</span>
                        <span class="text-gray-900">{{ profile.join_date|date:"Yå¹´mæœˆdæ—¥" }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">è²¸å‡ºä¸Šé™</span>
                        <span class="text-gray-900">{{ profile.max_loans }}å†Š</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">è²¸å‡ºæœŸé–“</span>
                        <span class="text-gray-900">{{ profile.loan_period_days }}æ—¥</span>
                    </div>
                </div>
            </div>

            <!-- åˆ©ç”¨çµ±è¨ˆ -->
            <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">åˆ©ç”¨çµ±è¨ˆ</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">ç¾åœ¨ã®è²¸å‡º</span>
                        <span class="text-gray-900 font-medium">{{ profile.current_loans_count }}å†Š</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">å»¶æ»ä¸­</span>
                        <span class="{% if profile.overdue_loans_count > 0 %}text-red-600{% else %}text-green-600{% endif %} font-medium">
                            {{ profile.overdue_loans_count }}å†Š
                        </span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">å€Ÿã‚Šã‚‰ã‚Œã‚‹æ®‹ã‚Š</span>
                        <span class="text-indigo-600 font-medium">
                            {% if profile.can_borrow %}
                                è²¸å‡ºå¯èƒ½
                            {% else %}
                                ä¸Šé™ã«é”ã—ã¦ã„ã¾ã™
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†</h3>
                
                <form method="POST" class="space-y-6">
                    {% csrf_token %}
                    
                    <!-- åŸºæœ¬æƒ…å ±ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
                            <input type="text" value="{{ user.username }}" readonly 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                            <input type="email" value="{{ user.email }}" readonly 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å§“</label>
                            <input type="text" value="{{ user.first_name }}" readonly 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å</label>
                            <input type="text" value="{{ user.last_name }}" readonly 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500">
                        </div>
                    </div>

                    <!-- ç·¨é›†å¯èƒ½ãªæƒ…å ± -->
                    <div>
                        <label for="{{ form.membership_type.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            ä¼šå“¡ç¨®åˆ¥
                        </label>
                        {{ form.membership_type }}
                        {% if form.membership_type.help_text %}
                            <p class="mt-1 text-sm text-gray-500">{{ form.membership_type.help_text }}</p>
                        {% endif %}
                        {% if form.membership_type.errors %}
                            <div class="mt-1 text-sm text-red-600">{{ form.membership_type.errors }}</div>
                        {% endif %}
                    </div>

                    <!-- å‚™è€ƒï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰ -->
                    {% if profile.notes %}
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ç®¡ç†è€…ãƒ¡ãƒ¢</label>
                        <textarea readonly class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500">{{ profile.notes }}</textarea>
                    </div>
                    {% endif %}

                    <div class="flex justify-end space-x-4">
                        <a href="{% url 'books:book_list' %}" 
                           class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </a>
                        <button type="submit" 
                                class="px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                            æ›´æ–°ã™ã‚‹
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    /* ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
    .form-control {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        line-height: 1.25rem;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    select.form-control {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
    }
</style>

<script>
    // ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«Bootstrapã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
    document.addEventListener('DOMContentLoaded', function() {
        const formFields = document.querySelectorAll('form input, form select, form textarea');
        formFields.forEach(field => {
            if (!field.hasAttribute('readonly')) {
                field.classList.add('form-control');
            }
        });
    });
</script>
{% endblock %}
