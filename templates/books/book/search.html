{% extends "base.html" %}

{% block title %}
{% if query %}ã€Œ{{ query }}ã€ã®æ¤œç´¢çµæœ{% else %}æ›¸ç±æ¤œç´¢{% endif %} - å›³æ›¸é¤¨ã‚·ã‚¹ãƒ†ãƒ 
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">æ›¸ç±æ¤œç´¢</h1>
        
        <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <form method="GET" action="{% url 'books:book_search' %}">
                <div class="flex">
                    <input type="text" 
                           name="q" 
                           value="{{ query }}" 
                           placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã€è‘—è€…ã€ISBNã€å†…å®¹ã§æ¤œç´¢..."
                           class="flex-1 px-4 py-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <button type="submit" 
                            class="bg-indigo-600 text-white px-8 py-3 rounded-r-lg hover:bg-indigo-700 transition-colors">
                        ğŸ” æ¤œç´¢
                    </button>
                </div>
            </form>
        </div>

        <!-- æ¤œç´¢çµæœã®æ¦‚è¦ -->
        {% if query %}
        <div class="mb-6">
            <p class="text-gray-600">
                ã€Œ<span class="font-semibold text-gray-900">{{ query }}</span>ã€ã®æ¤œç´¢çµæœ: 
                <span class="font-semibold">{{ books|length }}ä»¶</span>
            </p>
        </div>
        {% endif %}
    </div>

    <!-- æ¤œç´¢çµæœ -->
    {% if books %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for book in books %}
            <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                <div class="aspect-w-3 aspect-h-4 bg-gray-200">
                    {% if book.image %}
                        <img src="{{ book.image.url }}" alt="{{ book.title }}" class="w-full h-48 object-cover">
                    {% else %}
                        <div class="w-full h-48 bg-gray-300 flex items-center justify-center">
                            <span class="text-gray-500 text-6xl">ğŸ“š</span>
                        </div>
                    {% endif %}
                </div>
                <div class="p-4">
                    <div class="mb-2">
                        <span class="inline-block bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded-full">
                            {{ book.category.name }}
                        </span>
                    </div>
                    
                    <h3 class="font-semibold text-lg mb-2 text-gray-900 line-clamp-2">
                        <a href="{{ book.get_absolute_url }}" class="hover:text-indigo-600">
                            {{ book.title }}
                        </a>
                    </h3>
                    <p class="text-gray-600 mb-2">è‘—è€…: {{ book.author }}</p>
                    <p class="text-gray-500 text-sm mb-3">å‡ºç‰ˆç¤¾: {{ book.publisher }}</p>
                    
                    <!-- æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºï¼ˆç°¡æ˜“ç‰ˆï¼‰ -->
                    {% if book.description and query in book.description %}
                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">
                        {{ book.description|truncatewords:15 }}
                    </p>
                    {% endif %}
                    
                    <div class="flex items-center justify-between">
                        <span class="text-sm {% if book.is_available %}text-green-600{% else %}text-red-600{% endif %}">
                            {% if book.is_available %}
                                åˆ©ç”¨å¯èƒ½ ({{ book.available_copies }}å†Š)
                            {% else %}
                                è²¸å‡ºä¸­
                            {% endif %}
                        </span>
                        <a href="{{ book.get_absolute_url }}" 
                           class="bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700">
                            è©³ç´°
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% elif query %}
        <!-- æ¤œç´¢çµæœãŒ0ä»¶ã®å ´åˆ -->
        <div class="text-center py-12">
            <span class="text-6xl text-gray-400 mb-4 block">ğŸ”</span>
            <h2 class="text-xl text-gray-600 mb-2">æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h2>
            <p class="text-gray-500 mb-6">
                ã€Œ{{ query }}ã€ã«ä¸€è‡´ã™ã‚‹æ›¸ç±ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>
                åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
            </p>
            <div class="space-y-2 text-sm text-gray-600">
                <p><strong>æ¤œç´¢ã®ãƒ’ãƒ³ãƒˆ:</strong></p>
                <ul class="list-disc list-inside space-y-1">
                    <li>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’çŸ­ãã—ã¦ã¿ã¦ãã ã•ã„</li>
                    <li>æ¼¢å­—ãƒ»ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠã‚’å¤‰ãˆã¦ã¿ã¦ãã ã•ã„</li>
                    <li>è‘—è€…åã‚„ISBNã§ã‚‚æ¤œç´¢ã§ãã¾ã™</li>
                </ul>
            </div>
        </div>
    {% else %}
        <!-- åˆæœŸè¡¨ç¤ºï¼ˆæ¤œç´¢å‰ï¼‰ -->
        <div class="text-center py-12">
            <span class="text-6xl text-gray-400 mb-4 block">ğŸ“š</span>
            <h2 class="text-xl text-gray-600 mb-2">æ›¸ç±ã‚’æ¤œç´¢</h2>
            <p class="text-gray-500">
                ã‚¿ã‚¤ãƒˆãƒ«ã€è‘—è€…ã€ISBNã€å†…å®¹ã§æ›¸ç±ã‚’æ¤œç´¢ã§ãã¾ã™ã€‚
            </p>
        </div>
    {% endif %}
</div>
{% endblock %}
